

<!DOCTYPE html>
<html lang="zh-CN" >



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/Hexo/img/csdn.png">
  <link rel="icon" href="/Hexo/img/csdn.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#DAA520">
  <meta name="author" content="æ˜Ÿ">
  <meta name="keywords" content="">
  
    <meta name="description" content="Zookeeper1)åˆè¯† Zookeeper1.1)Zookeeperæ¦‚å¿µâ€¢Zookeeper æ˜¯ Apache Hadoop é¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡ã€‚ â€¢Zookeeper ç¿»è¯‘è¿‡æ¥å°±æ˜¯ åŠ¨ç‰©å›­ç®¡ç†å‘˜ï¼Œä»–æ˜¯ç”¨æ¥ç®¡ Hadoopï¼ˆå¤§è±¡ï¼‰ã€Hive(èœœèœ‚)ã€Pig(å° çŒª)çš„ç®¡ç†å‘˜ã€‚ç®€ç§°zk â€¢Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åè°ƒæœåŠ¡ã€‚ â€¢Zookeepe">
<meta property="og:type" content="website">
<meta property="og:title" content="zookeeperè®²ä¹‰">
<meta property="og:url" content="https://1902756969.github.io/Hexo/pages%20-%20%E7%BD%91%E5%9B%BE%E7%89%88/zookeeper%E8%AE%B2%E4%B9%89md.html">
<meta property="og:site_name" content="â­â­â­">
<meta property="og:description" content="Zookeeper1)åˆè¯† Zookeeper1.1)Zookeeperæ¦‚å¿µâ€¢Zookeeper æ˜¯ Apache Hadoop é¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡ã€‚ â€¢Zookeeper ç¿»è¯‘è¿‡æ¥å°±æ˜¯ åŠ¨ç‰©å›­ç®¡ç†å‘˜ï¼Œä»–æ˜¯ç”¨æ¥ç®¡ Hadoopï¼ˆå¤§è±¡ï¼‰ã€Hive(èœœèœ‚)ã€Pig(å° çŒª)çš„ç®¡ç†å‘˜ã€‚ç®€ç§°zk â€¢Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åè°ƒæœåŠ¡ã€‚ â€¢Zookeepe">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://1902756969.github.io/img/202203101244091.png">
<meta property="article:published_time" content="2022-01-28T14:30:03.000Z">
<meta property="article:modified_time" content="2022-03-26T05:25:50.403Z">
<meta property="article:author" content="æ˜Ÿ">
<meta property="article:tag" content="zookeeper">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://1902756969.github.io/img/202203101244091.png">
  
  
  <title>zookeeperè®²ä¹‰ - â­â­â­</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />





<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/Hexo/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/Hexo/css/highlight.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"1902756969.github.io","root":"/Hexo/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":" â¡"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/Hexo/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/Hexo/js/utils.js" ></script>
  <script  src="/Hexo/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/Hexo/">
      <strong>ğŸ›</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/categories/">
                <i class="iconfont icon-category-fill"></i>
                ç›®å½•
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Hexo/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/Hexo/img/bg5.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="zookeeperè®²ä¹‰"></span>
          
        </div>

        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      <div class="container nopadding-x-md">
        <div id="board"
          >
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                

<article class="page-content">
  <h1 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h1><h2 id="1-åˆè¯†-Zookeeper"><a href="#1-åˆè¯†-Zookeeper" class="headerlink" title="1)åˆè¯† Zookeeper"></a>1)åˆè¯† Zookeeper</h2><h3 id="1-1-Zookeeperæ¦‚å¿µ"><a href="#1-1-Zookeeperæ¦‚å¿µ" class="headerlink" title="1.1)Zookeeperæ¦‚å¿µ"></a>1.1)Zookeeperæ¦‚å¿µ</h3><p>â€¢Zookeeper æ˜¯ Apache Hadoop é¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡ã€‚</p>
<p>â€¢Zookeeper ç¿»è¯‘è¿‡æ¥å°±æ˜¯ åŠ¨ç‰©å›­ç®¡ç†å‘˜ï¼Œä»–æ˜¯ç”¨æ¥ç®¡ Hadoopï¼ˆå¤§è±¡ï¼‰ã€Hive(èœœèœ‚)ã€Pig(å° çŒª)çš„ç®¡ç†å‘˜ã€‚ç®€ç§°zk</p>
<p>â€¢Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åè°ƒæœåŠ¡ã€‚</p>
<p>â€¢Zookeeper æä¾›çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<p>â€¢é…ç½®ç®¡ç†</p>
<p>â€¢åˆ†å¸ƒå¼é”</p>
<p>â€¢é›†ç¾¤ç®¡ç†</p>
<p><img src="/Hexo/../img/202203121507475.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592054580488"></p>
<p><img src="/Hexo/../img/202203121507388.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592054603167"></p>
<h2 id="2-ZooKeeper-å®‰è£…ä¸é…ç½®"><a href="#2-ZooKeeper-å®‰è£…ä¸é…ç½®" class="headerlink" title="2)ZooKeeper å®‰è£…ä¸é…ç½®"></a>2)ZooKeeper å®‰è£…ä¸é…ç½®</h2><h3 id="2-1-ä¸‹è½½å®‰è£…"><a href="#2-1-ä¸‹è½½å®‰è£…" class="headerlink" title="2.1) ä¸‹è½½å®‰è£…"></a>2.1) ä¸‹è½½å®‰è£…</h3><h4 id="2-1-1ã€ç¯å¢ƒå‡†å¤‡"><a href="#2-1-1ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.1.1ã€ç¯å¢ƒå‡†å¤‡"></a><strong>2.1.1ã€ç¯å¢ƒå‡†å¤‡</strong></h4><p>ZooKeeperæœåŠ¡å™¨æ˜¯ç”¨Javaåˆ›å»ºçš„ï¼Œå®ƒè¿è¡Œåœ¨JVMä¹‹ä¸Šã€‚éœ€è¦å®‰è£…JDK 7æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</p>
<h4 id="2-1-2ã€ä¸Šä¼ "><a href="#2-1-2ã€ä¸Šä¼ " class="headerlink" title="2.1.2ã€ä¸Šä¼ "></a><strong>2.1.2ã€ä¸Šä¼ </strong></h4><p>å°†ä¸‹è½½çš„ZooKeeperæ”¾åˆ°&#x2F;opt&#x2F;ZooKeeperç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šä¼ zookeeper alt+p</span><br>put f:/setup/apache-zookeeper-3.5.6-bin.tar.gz<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰“å¼€ optç›®å½•</span><br>cd /opt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºzooKeeperç›®å½•</span><br>mkdir  zooKeeper<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†zookeeperå®‰è£…åŒ…ç§»åŠ¨åˆ° /opt/zooKeeper</span><br>mv apache-zookeeper-3.5.6-bin.tar.gz /opt/zookeeper/<br></code></pre></td></tr></table></figure>

<h4 id="2-1-3ã€è§£å‹"><a href="#2-1-3ã€è§£å‹" class="headerlink" title="2.1.3ã€è§£å‹"></a><strong>2.1.3ã€è§£å‹</strong></h4><p>å°†taråŒ…è§£å‹åˆ°&#x2F;opt&#x2F;zookeeperç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxvf apache-ZooKeeper-3.5.6-bin.tar.gz <br></code></pre></td></tr></table></figure>

<h3 id="2-2-é…ç½®å¯åŠ¨"><a href="#2-2-é…ç½®å¯åŠ¨" class="headerlink" title="2.2) é…ç½®å¯åŠ¨"></a>2.2) é…ç½®å¯åŠ¨</h3><h4 id="2-2-1ã€é…ç½®zoo-cfg"><a href="#2-2-1ã€é…ç½®zoo-cfg" class="headerlink" title="2.2.1ã€é…ç½®zoo.cfg"></a><strong>2.2.1ã€é…ç½®zoo.cfg</strong></h4><p>è¿›å…¥åˆ°confç›®å½•æ‹·è´ä¸€ä¸ªzoo_sample.cfgå¹¶å®Œæˆé…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿›å…¥åˆ°confç›®å½•</span><br>cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‹·è´</span><br>cp  zoo_sample.cfg  zoo.cfg<br></code></pre></td></tr></table></figure>



<p>ä¿®æ”¹zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰“å¼€ç›®å½•</span><br>cd /opt/zooKeeper/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºzooKeeperå­˜å‚¨ç›®å½•</span><br>mkdir  zkdata<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹zoo.cfg</span><br>vim /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/zoo.cfg<br></code></pre></td></tr></table></figure>

<p><img src="/Hexo/../img/202203121507501.png" srcset="/Hexo/img/loading.gif" lazyload alt="1577548250377"></p>
<p>ä¿®æ”¹å­˜å‚¨ç›®å½•ï¼šdataDir&#x3D;&#x2F;opt&#x2F;zookeeper&#x2F;zkdata</p>
<h4 id="2-2-2ã€å¯åŠ¨ZooKeeper"><a href="#2-2-2ã€å¯åŠ¨ZooKeeper" class="headerlink" title="2.2.2ã€å¯åŠ¨ZooKeeper"></a><strong>2.2.2ã€å¯åŠ¨ZooKeeper</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/bin/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨</span><br> ./zkServer.sh  start<br></code></pre></td></tr></table></figure>

<p><img src="/Hexo/../img/202203121511797.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151138755"></p>
<p>çœ‹åˆ°ä¸Šå›¾è¡¨ç¤ºZooKeeperæˆåŠŸå¯åŠ¨</p>
<p><strong>3ã€æŸ¥çœ‹ZooKeeperçŠ¶æ€</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./zkServer.sh status<br></code></pre></td></tr></table></figure>

<p>zookeeperå¯åŠ¨æˆåŠŸã€‚standaloneä»£è¡¨zkæ²¡æœ‰æ­å»ºé›†ç¾¤ï¼Œç°åœ¨æ˜¯å•èŠ‚ç‚¹</p>
<p><img src="/Hexo/../img/202203121511659.png" srcset="/Hexo/img/loading.gif" lazyload alt="1577548175232"></p>
<p>zookeeperæ²¡æœ‰å¯åŠ¨</p>
<p><img src="/Hexo/../img/202203121511702.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151128652"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="3-ZooKeeper-å‘½ä»¤æ“ä½œ"><a href="#3-ZooKeeper-å‘½ä»¤æ“ä½œ" class="headerlink" title="3)ZooKeeper å‘½ä»¤æ“ä½œ"></a>3)ZooKeeper å‘½ä»¤æ“ä½œ</h2><h3 id="3-1-Zookeeperå‘½ä»¤æ“ä½œæ•°æ®æ¨¡å‹"><a href="#3-1-Zookeeperå‘½ä»¤æ“ä½œæ•°æ®æ¨¡å‹" class="headerlink" title="3.1)Zookeeperå‘½ä»¤æ“ä½œæ•°æ®æ¨¡å‹"></a>3.1)Zookeeperå‘½ä»¤æ“ä½œæ•°æ®æ¨¡å‹</h3><p>â€¢ZooKeeper æ˜¯ä¸€ä¸ª<font color='red'>æ ‘å½¢ç›®å½•</font>æœåŠ¡,å…¶æ•°æ®æ¨¡å‹å’ŒUnixçš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘å¾ˆç±»ä¼¼ï¼Œæ‹¥æœ‰ä¸€ä¸ªå±‚æ¬¡åŒ–ç»“æ„ã€‚</p>
<p>â€¢è¿™é‡Œé¢çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¢«ç§°ä¸ºï¼š ZNodeï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šä¿å­˜è‡ªå·±çš„æ•°æ®å’ŒèŠ‚ç‚¹ä¿¡æ¯ã€‚ </p>
<p>â€¢ èŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å­èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å°‘é‡ï¼ˆ1MBï¼‰æ•°æ®å­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¹‹ä¸‹ã€‚</p>
<p>â€¢èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š</p>
<p>â€¢PERSISTENT æŒä¹…åŒ–èŠ‚ç‚¹ </p>
<p>â€¢EPHEMERAL ä¸´æ—¶èŠ‚ç‚¹ ï¼š-e</p>
<p>â€¢PERSISTENT_SEQUENTIAL æŒä¹…åŒ–é¡ºåºèŠ‚ç‚¹ ï¼š-s</p>
<p>â€¢EPHEMERAL_SEQUENTIAL ä¸´æ—¶é¡ºåºèŠ‚ç‚¹  ï¼š-es</p>
<p><img src="/Hexo/../img/202203121512484.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151241438"></p>
<p><img src="/Hexo/../img/202203121509147.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592054844023"></p>
<h3 id="3-2-Zookeeperå‘½ä»¤æ“ä½œæœåŠ¡ç«¯å‘½ä»¤"><a href="#3-2-Zookeeperå‘½ä»¤æ“ä½œæœåŠ¡ç«¯å‘½ä»¤" class="headerlink" title="3.2)Zookeeperå‘½ä»¤æ“ä½œæœåŠ¡ç«¯å‘½ä»¤"></a><strong>3.2)Zookeeperå‘½ä»¤æ“ä½œæœåŠ¡ç«¯å‘½ä»¤</strong></h3><p>â€¢å¯åŠ¨ ZooKeeper æœåŠ¡: .&#x2F;zkServer.sh start</p>
<p>â€¢æŸ¥çœ‹ ZooKeeper æœåŠ¡çŠ¶æ€: .&#x2F;zkServer.sh status</p>
<p>â€¢åœæ­¢ ZooKeeper æœåŠ¡: .&#x2F;zkServer.sh stop </p>
<p>â€¢é‡å¯ ZooKeeper æœåŠ¡: .&#x2F;zkServer.sh restart </p>
<p><img src="/Hexo/../img/202203121512852.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592055088686"></p>
<h3 id="3-3-Zookeeperå®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤"><a href="#3-3-Zookeeperå®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤" class="headerlink" title="3.3)Zookeeperå®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤"></a><strong>3.3)Zookeeperå®¢æˆ·ç«¯å¸¸ç”¨å‘½ä»¤</strong></h3><p>â€¢è¿æ¥ZooKeeperæœåŠ¡ç«¯</p>
<p><font color='red'>æ³¨æ„-ä¸å¯å¤åˆ¶</font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">./zkCli.sh â€“server ip:port<br> ./zkCli.sh -server localhost:2181<br></code></pre></td></tr></table></figure>

<p>â€¢æ–­å¼€è¿æ¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">quit<br></code></pre></td></tr></table></figure>

<p>â€¢æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">help<br></code></pre></td></tr></table></figure>

<p>â€¢æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> ç›®å½•<br></code></pre></td></tr></table></figure>

<p>â€¢åˆ›å»ºèŠ‚ç‚¹</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">create</span> /èŠ‚ç‚¹<span class="hljs-built_in">path</span> value<br></code></pre></td></tr></table></figure>

<p>â€¢è·å–èŠ‚ç‚¹å€¼</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">get</span> /èŠ‚ç‚¹<span class="hljs-type">path</span><br></code></pre></td></tr></table></figure>

<p>â€¢è®¾ç½®èŠ‚ç‚¹å€¼</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">set</span> /èŠ‚ç‚¹<span class="hljs-built_in">path</span> value<br></code></pre></td></tr></table></figure>

<p>â€¢åˆ é™¤å•ä¸ªèŠ‚ç‚¹</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">delete</span> /èŠ‚ç‚¹<span class="hljs-keyword">path</span><br></code></pre></td></tr></table></figure>

<p>â€¢åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">deleteall /èŠ‚ç‚¹<span class="hljs-built_in">path</span><br></code></pre></td></tr></table></figure>

<p><img src="/Hexo/../img/202203121512697.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592055332198"></p>
<p><img src="/Hexo/../img/202203121512020.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592055345400"></p>
<h3 id="3-4-å®¢æˆ·ç«¯å‘½ä»¤-åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹"><a href="#3-4-å®¢æˆ·ç«¯å‘½ä»¤-åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹" class="headerlink" title="3.4)å®¢æˆ·ç«¯å‘½ä»¤-åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹"></a>3.4)å®¢æˆ·ç«¯å‘½ä»¤-åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹</h3><p>â€¢åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span> -<span class="hljs-built_in">e</span> /èŠ‚ç‚¹<span class="hljs-keyword">path</span> <span class="hljs-keyword">value</span><br></code></pre></td></tr></table></figure>

<p>â€¢åˆ›å»ºé¡ºåºèŠ‚ç‚¹</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">create</span> -s /èŠ‚ç‚¹<span class="hljs-built_in">path</span> value<br></code></pre></td></tr></table></figure>

<p>åˆ›å»ºé¡ºåºä¸´æ—¶ç»“ç‚¹</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">create</span> -es /èŠ‚ç‚¹<span class="hljs-built_in">path</span> value<br></code></pre></td></tr></table></figure>

<p>â€¢æŸ¥è¯¢èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> â€“s /èŠ‚ç‚¹path <br></code></pre></td></tr></table></figure>

<p>â€¢czxidï¼šèŠ‚ç‚¹è¢«åˆ›å»ºçš„äº‹åŠ¡ID </p>
<p>â€¢ctime: åˆ›å»ºæ—¶é—´ </p>
<p>â€¢mzxid: æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„äº‹åŠ¡ID </p>
<p>â€¢mtime: ä¿®æ”¹æ—¶é—´ </p>
<p>â€¢pzxidï¼šå­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„äº‹åŠ¡ID</p>
<p>â€¢cversionï¼šå­èŠ‚ç‚¹çš„ç‰ˆæœ¬å· </p>
<p>â€¢dataversionï¼šæ•°æ®ç‰ˆæœ¬å· </p>
<p>â€¢aclversionï¼šæƒé™ç‰ˆæœ¬å· </p>
<p>â€¢ephemeralOwnerï¼šç”¨äºä¸´æ—¶èŠ‚ç‚¹ï¼Œä»£è¡¨ä¸´æ—¶èŠ‚ç‚¹çš„äº‹åŠ¡IDï¼Œå¦‚æœä¸ºæŒä¹…èŠ‚ç‚¹åˆ™ä¸º0 </p>
<p>â€¢dataLengthï¼šèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®çš„é•¿åº¦ </p>
<p>â€¢numChildrenï¼šå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•° </p>
<p><img src="/Hexo/../img/202203121512699.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592055462588"></p>
<p><img src="/Hexo/../img/202203122111362.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312211150283"></p>
<h6 id="2022å¹´3æœˆ12æ—¥21-16-02"><a href="#2022å¹´3æœˆ12æ—¥21-16-02" class="headerlink" title="2022å¹´3æœˆ12æ—¥21:16:02"></a>2022å¹´3æœˆ12æ—¥21:16:02</h6><h2 id="4-ZooKeeper-JavaAPI-æ“ä½œ"><a href="#4-ZooKeeper-JavaAPI-æ“ä½œ" class="headerlink" title="4)ZooKeeper JavaAPI æ“ä½œ"></a>4)ZooKeeper JavaAPI æ“ä½œ</h2><h3 id="4-1-uratorä»‹ç»"><a href="#4-1-uratorä»‹ç»" class="headerlink" title="4.1)uratorä»‹ç»"></a>4.1)uratorä»‹ç»</h3><p>â€¢Curator æ˜¯ Apache ZooKeeper çš„Javaå®¢æˆ·ç«¯åº“ã€‚</p>
<p>â€¢å¸¸è§çš„ZooKeeper Java API ï¼š</p>
<p>â€¢åŸç”ŸJava API</p>
<p>â€¢ZkClient</p>
<p>â€¢Curator</p>
<p>â€¢Curator é¡¹ç›®çš„ç›®æ ‡æ˜¯ç®€åŒ– ZooKeeper å®¢æˆ·ç«¯çš„ä½¿ç”¨ã€‚</p>
<p>â€¢Curator æœ€åˆæ˜¯ Netfix ç ”å‘çš„,åæ¥æçŒ®äº† Apache åŸºé‡‘ä¼š,ç›®å‰æ˜¯ Apache çš„é¡¶çº§é¡¹ç›®ã€‚</p>
<p>â€¢å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="http://curator.apache.org/">http://curator.apache.org/</a></p>
<h3 id="4-2-JavaAPIæ“ä½œå»ºç«‹è¿æ¥"><a href="#4-2-JavaAPIæ“ä½œå»ºç«‹è¿æ¥" class="headerlink" title="4.2)JavaAPIæ“ä½œå»ºç«‹è¿æ¥"></a>4.2)JavaAPIæ“ä½œå»ºç«‹è¿æ¥</h3><p>1ï¼Œæ­å»ºé¡¹ç›®</p>
<p>åˆ›å»ºé¡¹ç›®curator-zk</p>
<p>å¼•å…¥pomå’Œæ—¥å¿—æ–‡ä»¶</p>
<p>èµ„æ–™æ–‡ä»¶å¤¹ä¸‹pom.xmlå’Œlog4j.properties</p>
<p><img src="/Hexo/../img/202203121512563.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592055569716"></p>
<p>2ã€åˆ›å»ºæµ‹è¯•ç±»ï¼Œä½¿ç”¨curatorè¿æ¥zookeeper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConnect</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//é‡è¯•ç­–ç•¥</span><br>    <span class="hljs-type">RetryPolicy</span> <span class="hljs-variable">retryPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(<span class="hljs-number">3000</span>, <span class="hljs-number">10</span>);<br>    <span class="hljs-comment">//2.ç¬¬äºŒç§æ–¹å¼</span><br>    <span class="hljs-comment">//CuratorFrameworkFactory.builder();</span><br>    client = CuratorFrameworkFactory.builder()<br>        .connectString(<span class="hljs-string">&quot;192.168.200.130:2181&quot;</span>)<br>        .sessionTimeoutMs(<span class="hljs-number">60</span> * <span class="hljs-number">1000</span>)<br>        .connectionTimeoutMs(<span class="hljs-number">15</span> * <span class="hljs-number">1000</span>)<br>        .retryPolicy(retryPolicy)<br>        .namespace(<span class="hljs-string">&quot;itheima&quot;</span>)<br>        .build();<br>    <span class="hljs-comment">//å¼€å¯è¿æ¥</span><br>    client.start();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-Zookeeper-JavaAPIæ“ä½œ-åˆ›å»ºèŠ‚ç‚¹"><a href="#4-3-Zookeeper-JavaAPIæ“ä½œ-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="4.3)Zookeeper JavaAPIæ“ä½œ-åˆ›å»ºèŠ‚ç‚¹"></a>4.3)Zookeeper JavaAPIæ“ä½œ-åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* åˆ›å»ºèŠ‚ç‚¹ï¼šcreate æŒä¹… ä¸´æ—¶ é¡ºåº æ•°æ®</span><br><span class="hljs-comment">* 1. åŸºæœ¬åˆ›å»º ï¼šcreate().forPath(&quot;&quot;)</span><br><span class="hljs-comment">* 2. åˆ›å»ºèŠ‚ç‚¹ å¸¦æœ‰æ•°æ®:create().forPath(&quot;&quot;,data)</span><br><span class="hljs-comment">* 3. è®¾ç½®èŠ‚ç‚¹çš„ç±»å‹ï¼šcreate().withMode().forPath(&quot;&quot;,data)</span><br><span class="hljs-comment">* 4. åˆ›å»ºå¤šçº§èŠ‚ç‚¹  /app1/p1 ï¼šcreate().creatingParentsIfNeeded().forPath(&quot;&quot;,data)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//2. åˆ›å»ºèŠ‚ç‚¹ å¸¦æœ‰æ•°æ®</span><br>    <span class="hljs-comment">//å¦‚æœåˆ›å»ºèŠ‚ç‚¹ï¼Œæ²¡æœ‰æŒ‡å®šæ•°æ®ï¼Œåˆ™é»˜è®¤å°†å½“å‰å®¢æˆ·ç«¯çš„ipä½œä¸ºæ•°æ®å­˜å‚¨</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> client.create().forPath(<span class="hljs-string">&quot;/app2&quot;</span>, <span class="hljs-string">&quot;hehe&quot;</span>.getBytes());<br>    System.out.println(path);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreate2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//1. åŸºæœ¬åˆ›å»º</span><br>    <span class="hljs-comment">//å¦‚æœåˆ›å»ºèŠ‚ç‚¹ï¼Œæ²¡æœ‰æŒ‡å®šæ•°æ®ï¼Œåˆ™é»˜è®¤å°†å½“å‰å®¢æˆ·ç«¯çš„ipä½œä¸ºæ•°æ®å­˜å‚¨</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> client.create().forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>    System.out.println(path);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreate3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//3. è®¾ç½®èŠ‚ç‚¹çš„ç±»å‹</span><br>    <span class="hljs-comment">//é»˜è®¤ç±»å‹ï¼šæŒä¹…åŒ–</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> client.create().withMode(CreateMode.EPHEMERAL).forPath(<span class="hljs-string">&quot;/app3&quot;</span>);<br>    System.out.println(path);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreate4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//4. åˆ›å»ºå¤šçº§èŠ‚ç‚¹  /app1/p1</span><br>    <span class="hljs-comment">//creatingParentsIfNeeded():å¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºçˆ¶èŠ‚ç‚¹</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> client.create().creatingParentsIfNeeded().forPath(<span class="hljs-string">&quot;/app4/p1&quot;</span>);<br>    System.out.println(path);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-ZookeeperJavaAPIæ“ä½œ-æŸ¥è¯¢èŠ‚ç‚¹"><a href="#4-4-ZookeeperJavaAPIæ“ä½œ-æŸ¥è¯¢èŠ‚ç‚¹" class="headerlink" title="4.4)ZookeeperJavaAPIæ“ä½œ-æŸ¥è¯¢èŠ‚ç‚¹"></a>4.4)ZookeeperJavaAPIæ“ä½œ-æŸ¥è¯¢èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢èŠ‚ç‚¹ï¼š</span><br><span class="hljs-comment">* 1. æŸ¥è¯¢æ•°æ®ï¼šget: getData().forPath()</span><br><span class="hljs-comment">* 2. æŸ¥è¯¢å­èŠ‚ç‚¹ï¼š ls: getChildren().forPath()</span><br><span class="hljs-comment">* 3. æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼šls -s:getData().storingStatIn(çŠ¶æ€å¯¹è±¡).forPath()</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGet1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//1. æŸ¥è¯¢æ•°æ®ï¼šget</span><br>    <span class="hljs-type">byte</span>[] data = client.getData().forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>    System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(data));<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGet2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 2. æŸ¥è¯¢å­èŠ‚ç‚¹ï¼š ls</span><br>    List&lt;String&gt; path = client.getChildren().forPath(<span class="hljs-string">&quot;/&quot;</span>);<br>    System.out.println(path);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGet3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Stat</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stat</span>();<br>    System.out.println(status);<br>    <span class="hljs-comment">//3. æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼šls -s</span><br>    client.getData().storingStatIn(status).forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>    System.out.println(status);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Statç±»</p>
<h3 id="4-5-Zookeeper-JavaAPIæ“ä½œ-ä¿®æ”¹èŠ‚ç‚¹"><a href="#4-5-Zookeeper-JavaAPIæ“ä½œ-ä¿®æ”¹èŠ‚ç‚¹" class="headerlink" title="4.5)Zookeeper JavaAPIæ“ä½œ-ä¿®æ”¹èŠ‚ç‚¹"></a>4.5)Zookeeper JavaAPIæ“ä½œ-ä¿®æ”¹èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* ä¿®æ”¹æ•°æ®</span><br><span class="hljs-comment">* 1. åŸºæœ¬ä¿®æ”¹æ•°æ®ï¼šsetData().forPath()</span><br><span class="hljs-comment">* 2. æ ¹æ®ç‰ˆæœ¬ä¿®æ”¹: setData().withVersion().forPath()</span><br><span class="hljs-comment">* * version æ˜¯é€šè¿‡æŸ¥è¯¢å‡ºæ¥çš„ã€‚ç›®çš„å°±æ˜¯ä¸ºäº†è®©å…¶ä»–å®¢æˆ·ç«¯æˆ–è€…çº¿ç¨‹ä¸å¹²æ‰°æˆ‘ã€‚</span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>	client.setData().forPath(<span class="hljs-string">&quot;/app1&quot;</span>, <span class="hljs-string">&quot;itcast&quot;</span>.getBytes());<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSetForVersion</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">Stat</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stat</span>();<br>    <span class="hljs-comment">//3. æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼šls -s</span><br>    client.getData().storingStatIn(status).forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> status.getVersion();<span class="hljs-comment">//æŸ¥è¯¢å‡ºæ¥çš„ 3</span><br>    System.out.println(version);<br>    client.setData().withVersion(version).forPath(<span class="hljs-string">&quot;/app1&quot;</span>, <span class="hljs-string">&quot;hehe&quot;</span>.getBytes());<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-6-Zookeeper-JavaAPIæ“ä½œ-åˆ é™¤èŠ‚ç‚¹"><a href="#4-6-Zookeeper-JavaAPIæ“ä½œ-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="4.6)Zookeeper JavaAPIæ“ä½œ-åˆ é™¤èŠ‚ç‚¹"></a>4.6)Zookeeper JavaAPIæ“ä½œ-åˆ é™¤èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* åˆ é™¤èŠ‚ç‚¹ï¼š delete deleteall</span><br><span class="hljs-comment">* 1. åˆ é™¤å•ä¸ªèŠ‚ç‚¹:delete().forPath(&quot;/app1&quot;);</span><br><span class="hljs-comment">* 2. åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹:delete().deletingChildrenIfNeeded().forPath(&quot;/app1&quot;);</span><br><span class="hljs-comment">* 3. å¿…é¡»æˆåŠŸçš„åˆ é™¤:ä¸ºäº†é˜²æ­¢ç½‘ç»œæŠ–åŠ¨ã€‚æœ¬è´¨å°±æ˜¯é‡è¯•ã€‚  client.delete().guaranteed().forPath(&quot;/app2&quot;);</span><br><span class="hljs-comment">* 4. å›è°ƒï¼šinBackground</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 1. åˆ é™¤å•ä¸ªèŠ‚ç‚¹</span><br>    client.delete().forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//2. åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span><br>    client.delete().deletingChildrenIfNeeded().forPath(<span class="hljs-string">&quot;/app4&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//3. å¿…é¡»æˆåŠŸçš„åˆ é™¤</span><br>    client.delete().guaranteed().forPath(<span class="hljs-string">&quot;/app2&quot;</span>);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//4. å›è°ƒ</span><br>    client.delete().guaranteed().inBackground(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BackgroundCallback</span>()&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processResult</span><span class="hljs-params">(CuratorFramework client, CuratorEvent event)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;æˆ‘è¢«åˆ é™¤äº†~&quot;</span>);<br>            System.out.println(event);<br>        &#125;<br>    &#125;).forPath(<span class="hljs-string">&quot;/app1&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h6 id="2022å¹´3æœˆ13æ—¥21-15-26"><a href="#2022å¹´3æœˆ13æ—¥21-15-26" class="headerlink" title="2022å¹´3æœˆ13æ—¥21:15:26"></a>2022å¹´3æœˆ13æ—¥21:15:26</h6><h3 id="4-7-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬æ¦‚è¿°"><a href="#4-7-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬æ¦‚è¿°" class="headerlink" title="4.7)Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬æ¦‚è¿°"></a>4.7)Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬æ¦‚è¿°</h3><p>â€¢ZooKeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šå»ï¼Œè¯¥æœºåˆ¶æ˜¯ ZooKeeper å®ç°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚</p>
<p>â€¢ZooKeeper ä¸­å¼•å…¥äº†Watcheræœºåˆ¶æ¥å®ç°äº†å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½èƒ½ï¼Œèƒ½å¤Ÿè®©å¤šä¸ªè®¢é˜…è€…åŒæ—¶ç›‘å¬æŸä¸€ä¸ªå¯¹è±¡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è‡ªèº«çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚</p>
<p>â€¢ZooKeeper åŸç”Ÿæ”¯æŒé€šè¿‡æ³¨å†ŒWatcheræ¥è¿›è¡Œäº‹ä»¶ç›‘å¬ï¼Œä½†æ˜¯å…¶ä½¿ç”¨å¹¶ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿</p>
<pre><code class="hljs">éœ€è¦å¼€å‘äººå‘˜è‡ªå·±åå¤æ³¨å†ŒWatcherï¼Œæ¯”è¾ƒç¹çã€‚
</code></pre>
<p>â€¢Curatorå¼•å…¥äº† Cache æ¥å®ç°å¯¹ ZooKeeper æœåŠ¡ç«¯äº‹ä»¶çš„ç›‘å¬ã€‚</p>
<p>â€¢ZooKeeperæä¾›äº†ä¸‰ç§Watcherï¼š</p>
<p>â€¢NodeCache : åªæ˜¯ç›‘å¬æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹</p>
<p>â€¢PathChildrenCache : ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹. </p>
<p>â€¢TreeCache : å¯ä»¥ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç±»ä¼¼äºPathChildrenCacheå’ŒNodeCacheçš„ç»„åˆ</p>
<p><img src="/Hexo/../img/202203121513884.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592057429708"></p>
<h3 id="4-8Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-NodeCache"><a href="#4-8Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-NodeCache" class="headerlink" title="4.8Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬-NodeCache"></a>4.8Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬-NodeCache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ¼”ç¤º NodeCacheï¼šç»™æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œç›‘å¬å™¨</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNodeCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//1. åˆ›å»ºNodeCacheå¯¹è±¡</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">NodeCache</span> <span class="hljs-variable">nodeCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeCache</span>(client,<span class="hljs-string">&quot;/app1&quot;</span>);<br>    <span class="hljs-comment">//2. æ³¨å†Œç›‘å¬</span><br>   	nodeCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeCacheListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nodeChanged</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹å˜åŒ–äº†~&quot;</span>);<br>            <span class="hljs-comment">//è·å–ä¿®æ”¹èŠ‚ç‚¹åçš„æ•°æ®</span><br>            <span class="hljs-type">byte</span>[] data = nodeCache.getCurrentData().getData();<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(data));<br>            &#125;<br>        &#125;);<br>    	<span class="hljs-comment">//3. å¼€å¯ç›‘å¬.å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™å¼€å¯ç›‘å¬æ˜¯ï¼ŒåŠ è½½ç¼“å†²æ•°æ®</span><br>    	nodeCache.start(<span class="hljs-literal">true</span>);<br>    	<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-9-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-PathChildrenCache"><a href="#4-9-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-PathChildrenCache" class="headerlink" title="4.9)Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬-PathChildrenCache"></a><strong>4.9)Zookeeper</strong> JavaAPIæ“ä½œ-Watchç›‘å¬-PathChildrenCache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPathChildrenCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//1.åˆ›å»ºç›‘å¬å¯¹è±¡</span><br>    <span class="hljs-type">PathChildrenCache</span> <span class="hljs-variable">pathChildrenCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathChildrenCache</span>(client,<span class="hljs-string">&quot;/app2&quot;</span>,<span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">//2. ç»‘å®šç›‘å¬å™¨</span><br>    pathChildrenCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PathChildrenCacheListener</span>() &#123;    			<span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">childEvent</span><span class="hljs-params">(CuratorFramework client, PathChildrenCacheEvent event)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;å­èŠ‚ç‚¹å˜åŒ–äº†~&quot;</span>);<br>            System.out.println(event);<br>            <span class="hljs-comment">//ç›‘å¬å­èŠ‚ç‚¹çš„æ•°æ®å˜æ›´ï¼Œå¹¶ä¸”æ‹¿åˆ°å˜æ›´åçš„æ•°æ®</span><br>            <span class="hljs-comment">//1.è·å–ç±»å‹</span><br>            PathChildrenCacheEvent.<span class="hljs-type">Type</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> event.getType();<br>            <span class="hljs-comment">//2.åˆ¤æ–­ç±»å‹æ˜¯å¦æ˜¯update</span><br>            <span class="hljs-keyword">if</span>(type.equals(PathChildrenCacheEvent.Type.CHILD_UPDATED))&#123;<br>                System.out.println(<span class="hljs-string">&quot;æ•°æ®å˜äº†ï¼ï¼ï¼&quot;</span>);<br>                <span class="hljs-type">byte</span>[] data = event.getData().getData();<br>                System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(data));<br>            &#125;<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">//3. å¼€å¯</span><br>    pathChildrenCache.start();<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-10-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-TreeCache"><a href="#4-10-Zookeeper-JavaAPIæ“ä½œ-Watchç›‘å¬-TreeCache" class="headerlink" title="4.10)Zookeeper JavaAPIæ“ä½œ-Watchç›‘å¬-TreeCache"></a><strong>4.10)Zookeeper</strong> JavaAPIæ“ä½œ-Watchç›‘å¬-TreeCache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ¼”ç¤º TreeCacheï¼šç›‘å¬æŸä¸ªèŠ‚ç‚¹è‡ªå·±å’Œæ‰€æœ‰å­èŠ‚ç‚¹ä»¬</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTreeCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//1. åˆ›å»ºç›‘å¬å™¨</span><br>    <span class="hljs-type">TreeCache</span> <span class="hljs-variable">treeCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeCache</span>(client,<span class="hljs-string">&quot;/app2&quot;</span>);<br>    <span class="hljs-comment">//2. æ³¨å†Œç›‘å¬</span><br>    treeCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeCacheListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">childEvent</span><span class="hljs-params">(CuratorFramework client, TreeCacheEvent event)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹å˜åŒ–äº†&quot;</span>);<br>            System.out.println(event);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">//3. å¼€å¯</span><br>    treeCache.start();<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-11-Zookeeperåˆ†å¸ƒå¼é”-æ¦‚å¿µ"><a href="#4-11-Zookeeperåˆ†å¸ƒå¼é”-æ¦‚å¿µ" class="headerlink" title="4.11)Zookeeperåˆ†å¸ƒå¼é”-æ¦‚å¿µ"></a>4.11)Zookeeperåˆ†å¸ƒå¼é”-æ¦‚å¿µ</h3><p>â€¢åœ¨æˆ‘ä»¬è¿›è¡Œå•æœºåº”ç”¨å¼€å‘ï¼Œæ¶‰åŠå¹¶å‘åŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨synchronizedæˆ–è€…Lockçš„æ–¹å¼æ¥è§£å†³å¤šçº¿ç¨‹é—´çš„ä»£ç åŒæ­¥é—®é¢˜ï¼Œè¿™æ—¶å¤šçº¿ç¨‹çš„è¿è¡Œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªJVMä¹‹ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p>
<p>â€¢ä½†å½“æˆ‘ä»¬çš„åº”ç”¨æ˜¯åˆ†å¸ƒå¼é›†ç¾¤å·¥ä½œçš„æƒ…å†µä¸‹ï¼Œå±äºå¤šJVMä¸‹çš„å·¥ä½œç¯å¢ƒï¼Œè·¨JVMä¹‹é—´å·²ç»æ— æ³•é€šè¿‡å¤šçº¿ç¨‹çš„é”è§£å†³åŒæ­¥é—®é¢˜ã€‚</p>
<p>â€¢é‚£ä¹ˆå°±éœ€è¦ä¸€ç§æ›´åŠ é«˜çº§çš„é”æœºåˆ¶ï¼Œæ¥å¤„ç†ç§è·¨æœºå™¨çš„è¿›ç¨‹ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜â€”â€”è¿™å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚</p>
<p><img src="/Hexo/../img/202203121513619.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592057871141"></p>
<h3 id="4-12-Zookeeper-åˆ†å¸ƒå¼é”-zookeeperåˆ†å¸ƒå¼é”åŸç†"><a href="#4-12-Zookeeper-åˆ†å¸ƒå¼é”-zookeeperåˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="4.12)Zookeeper åˆ†å¸ƒå¼é”-zookeeperåˆ†å¸ƒå¼é”åŸç†"></a><strong>4.12)Zookeeper</strong> åˆ†å¸ƒå¼é”-zookeeperåˆ†å¸ƒå¼é”åŸç†</h3><p>â€¢æ ¸å¿ƒæ€æƒ³ï¼šå½“å®¢æˆ·ç«¯è¦è·å–é”ï¼Œåˆ™åˆ›å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨å®Œé”ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p>
<p>1.å®¢æˆ·ç«¯è·å–é”æ—¶ï¼Œåœ¨lockèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚</p>
<p>2.ç„¶åè·å–lockä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹ä¹‹åï¼Œå¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹åºå·æœ€å°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥å®¢æˆ·ç«¯è·å–åˆ°äº†é”ã€‚ä½¿ç”¨å®Œé”åï¼Œå°†è¯¥èŠ‚ç‚¹åˆ é™¤ã€‚</p>
<p>3.å¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶élockæ‰€æœ‰å­èŠ‚ç‚¹ä¸­æœ€å°çš„ï¼Œè¯´æ˜è‡ªå·±è¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬åˆ é™¤äº‹ä»¶ã€‚</p>
<p>4.å¦‚æœå‘ç°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„</p>
<pre><code class="hljs">Watcherä¼šæ”¶åˆ°ç›¸åº”é€šçŸ¥ï¼Œæ­¤æ—¶å†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹

æ˜¯å¦æ˜¯lockå­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯åˆ™è·å–åˆ°äº†é”ï¼Œ

å¦‚æœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­è·å–åˆ°æ¯”è‡ªå·±å°çš„ä¸€ä¸ªèŠ‚ç‚¹

å¹¶æ³¨å†Œç›‘å¬ã€‚
</code></pre>
<p><img src="/Hexo/../img/202203121513004.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592057925831"></p>
<h3 id="4-13-Zookeeper-åˆ†å¸ƒå¼é”-æ¨¡æ‹Ÿ12306å”®ç¥¨æ¡ˆä¾‹"><a href="#4-13-Zookeeper-åˆ†å¸ƒå¼é”-æ¨¡æ‹Ÿ12306å”®ç¥¨æ¡ˆä¾‹" class="headerlink" title="4.13)Zookeeper åˆ†å¸ƒå¼é”-æ¨¡æ‹Ÿ12306å”®ç¥¨æ¡ˆä¾‹"></a><strong>4.13)Zookeeper</strong> åˆ†å¸ƒå¼é”-æ¨¡æ‹Ÿ12306å”®ç¥¨æ¡ˆä¾‹</h3><p><strong>Curatorå®ç°åˆ†å¸ƒå¼é”API</strong></p>
<ul>
<li><p>åœ¨Curatorä¸­æœ‰äº”ç§é”æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>InterProcessSemaphoreMutexï¼šåˆ†å¸ƒå¼æ’å®ƒé”ï¼ˆéå¯é‡å…¥é”ï¼‰</p>
</li>
<li><p>InterProcessMutexï¼šåˆ†å¸ƒå¼å¯é‡å…¥æ’å®ƒé”</p>
</li>
<li><p>InterProcessReadWriteLockï¼šåˆ†å¸ƒå¼è¯»å†™é”</p>
</li>
<li><p>InterProcessMultiLockï¼šå°†å¤šä¸ªé”ä½œä¸ºå•ä¸ªå®ä½“ç®¡ç†çš„å®¹å™¨</p>
</li>
<li><p>InterProcessSemaphoreV2ï¼šå…±äº«ä¿¡å·é‡</p>
</li>
</ul>
</li>
</ul>
<p><img src="/Hexo/../img/202203121513467.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592058017457"></p>
<p>1,åˆ›å»ºçº¿ç¨‹è¿›è¡ŒåŠ é”è®¾ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket12306</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">tickets</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<span class="hljs-comment">//æ•°æ®åº“çš„ç¥¨æ•°</span><br>    <span class="hljs-keyword">private</span> InterProcessMutex lock ;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            <span class="hljs-comment">//è·å–é”</span><br>            <span class="hljs-keyword">try</span> &#123;<br>            lock.acquire(<span class="hljs-number">3</span>, TimeUnit.SECONDS);<br>                <span class="hljs-keyword">if</span>(tickets &gt; <span class="hljs-number">0</span>)&#123;<br>                    System.out.println(Thread.currentThread()+<span class="hljs-string">&quot;:&quot;</span>+tickets);<br>                    Thread.sleep(<span class="hljs-number">100</span>);<br>                    tickets--;<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">//é‡Šæ”¾é”</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock.release();<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2,åˆ›å»ºè¿æ¥ï¼Œå¹¶ä¸”åˆå§‹åŒ–é”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Ticket12306</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//é‡è¯•ç­–ç•¥</span><br>    <span class="hljs-type">RetryPolicy</span> <span class="hljs-variable">retryPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(<span class="hljs-number">3000</span>, <span class="hljs-number">10</span>);<br>    <span class="hljs-comment">//2.ç¬¬äºŒç§æ–¹å¼</span><br>    <span class="hljs-comment">//CuratorFrameworkFactory.builder();</span><br>    <span class="hljs-type">CuratorFramework</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> CuratorFrameworkFactory.builder()<br>        .connectString(<span class="hljs-string">&quot;192.168.149.135:2181&quot;</span>)<br>        .sessionTimeoutMs(<span class="hljs-number">60</span> * <span class="hljs-number">1000</span>)<br>        .connectionTimeoutMs(<span class="hljs-number">15</span> * <span class="hljs-number">1000</span>)<br>        .retryPolicy(retryPolicy)<br>        .build();<br>    <span class="hljs-comment">//å¼€å¯è¿æ¥</span><br>    client.start();<br>    lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client,<span class="hljs-string">&quot;/lock&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3,è¿è¡Œå¤šä¸ªçº¿ç¨‹è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Ticket12306</span> <span class="hljs-variable">ticket12306</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket12306</span>();<br>        <span class="hljs-comment">//åˆ›å»ºå®¢æˆ·ç«¯</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ticket12306,<span class="hljs-string">&quot;æºç¨‹&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ticket12306,<span class="hljs-string">&quot;é£çŒª&quot;</span>);<br>        t1.start();<br>        t2.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-ZooKeeper-é›†ç¾¤æ­å»º"><a href="#5-ZooKeeper-é›†ç¾¤æ­å»º" class="headerlink" title="5)ZooKeeper é›†ç¾¤æ­å»º"></a>5)ZooKeeper é›†ç¾¤æ­å»º</h2><h3 id="5-1-Zookeeperé›†ç¾¤ä»‹ç»"><a href="#5-1-Zookeeperé›†ç¾¤ä»‹ç»" class="headerlink" title="5.1)Zookeeperé›†ç¾¤ä»‹ç»"></a><strong>5.1)Zookeeper</strong>é›†ç¾¤ä»‹ç»</h3><p>Leaderé€‰ä¸¾ï¼š</p>
<p>â€¢Serveridï¼šæœåŠ¡å™¨ID</p>
<p>  æ¯”å¦‚æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œç¼–å·åˆ†åˆ«æ˜¯1,2,3ã€‚</p>
<p>  ç¼–å·è¶Šå¤§åœ¨é€‰æ‹©ç®—æ³•ä¸­çš„æƒé‡è¶Šå¤§ã€‚</p>
<p>â€¢Zxidï¼šæ•°æ®ID</p>
<p>  æœåŠ¡å™¨ä¸­å­˜æ”¾çš„æœ€å¤§æ•°æ®ID.å€¼è¶Šå¤§è¯´æ˜æ•°æ®  è¶Šæ–°ï¼Œåœ¨é€‰ä¸¾ç®—æ³•ä¸­æ•°æ®è¶Šæ–°æƒé‡è¶Šå¤§ã€‚</p>
<p>â€¢åœ¨Leaderé€‰ä¸¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸå°ZooKeeper</p>
<pre><code class="hljs">è·å¾—äº†è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼Œ

åˆ™æ­¤ZooKeeperå°±å¯ä»¥æˆä¸ºLeaderäº†ã€‚
</code></pre>
<h3 id="5-2-æ­å»ºè¦æ±‚"><a href="#5-2-æ­å»ºè¦æ±‚" class="headerlink" title="5.2)æ­å»ºè¦æ±‚"></a>5.2)æ­å»ºè¦æ±‚</h3><p>çœŸå®çš„é›†ç¾¤æ˜¯éœ€è¦éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æµ‹è¯•æ—¶åŒæ—¶å¯åŠ¨å¾ˆå¤šä¸ªè™šæ‹Ÿæœºå†…å­˜ä¼šåƒä¸æ¶ˆï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šæ­å»º<strong>ä¼ªé›†ç¾¤</strong>ï¼Œä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½æ­å»ºåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œè¦æ±‚æ­å»ºä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„Zookeeperé›†ç¾¤ï¼ˆä¼ªé›†ç¾¤ï¼‰ã€‚</p>
<h3 id="5-3-å‡†å¤‡å·¥ä½œ"><a href="#5-3-å‡†å¤‡å·¥ä½œ" class="headerlink" title="5.3)å‡†å¤‡å·¥ä½œ"></a><strong>5.3)å‡†å¤‡å·¥ä½œ</strong></h3><p>é‡æ–°éƒ¨ç½²ä¸€å°è™šæ‹Ÿæœºä½œä¸ºæˆ‘ä»¬æ­å»ºé›†ç¾¤çš„æµ‹è¯•æœåŠ¡å™¨ã€‚</p>
<p>ï¼ˆ1ï¼‰å®‰è£…JDK  ã€æ­¤æ­¥éª¤çœç•¥ã€‘ã€‚</p>
<p>ï¼ˆ2ï¼‰Zookeeperå‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨<br>ï¼ˆ3ï¼‰å°†Zookeeperè§£å‹ ï¼Œå»ºç«‹&#x2F;usr&#x2F;local&#x2F;zookeeper-clusterç›®å½•ï¼Œå°†è§£å‹åçš„Zookeeperå¤åˆ¶åˆ°ä»¥ä¸‹ä¸‰ä¸ªç›®å½•</p>
<p>&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-1</p>
<p>&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-2</p>
<p>&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-3</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost ~]# mkdir /usr/local/zookeeper-cluster<br>[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-1<br>[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-2<br>[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-3<br></code></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰åˆ›å»ºdataç›®å½• ï¼Œå¹¶ä¸”å°† confä¸‹zoo_sample.cfg æ–‡ä»¶æ”¹åä¸º zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /usr/local/zookeeper-cluster/zookeeper-1/data<br>mkdir /usr/local/zookeeper-cluster/zookeeper-2/data<br>mkdir /usr/local/zookeeper-cluster/zookeeper-3/data<br><br>mv  /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br>mv  /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br>mv  /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br></code></pre></td></tr></table></figure>





<p>ï¼ˆ5ï¼‰ é…ç½®æ¯ä¸€ä¸ªZookeeper çš„dataDir å’Œ clientPort åˆ†åˆ«ä¸º2181  2182  2183</p>
<p>ä¿®æ”¹&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-1&#x2F;conf&#x2F;zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br><br>clientPort=2181<br>dataDir=/usr/local/zookeeper-cluster/zookeeper-1/data<br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-2&#x2F;conf&#x2F;zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br><br>clientPort=2182<br>dataDir=/usr/local/zookeeper-cluster/zookeeper-2/data<br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹&#x2F;usr&#x2F;local&#x2F;zookeeper-cluster&#x2F;zookeeper-3&#x2F;conf&#x2F;zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br><br>clientPort=2183<br>dataDir=/usr/local/zookeeper-cluster/zookeeper-3/data<br></code></pre></td></tr></table></figure>



<h3 id="5-4-é…ç½®é›†ç¾¤"><a href="#5-4-é…ç½®é›†ç¾¤" class="headerlink" title="5.4)é…ç½®é›†ç¾¤"></a><strong>5.4)é…ç½®é›†ç¾¤</strong></h3><p>ï¼ˆ1ï¼‰åœ¨æ¯ä¸ªzookeeperçš„ data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid æ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«æ˜¯1ã€2ã€3 ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„ID</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo 1 &gt;/usr/local/zookeeper-cluster/zookeeper-1/data/myid<br>echo 2 &gt;/usr/local/zookeeper-cluster/zookeeper-2/data/myid<br>echo 3 &gt;/usr/local/zookeeper-cluster/zookeeper-3/data/myid<br></code></pre></td></tr></table></figure>





<p>ï¼ˆ2ï¼‰åœ¨æ¯ä¸€ä¸ªzookeeper çš„ zoo.cfgé…ç½®å®¢æˆ·ç«¯è®¿é—®ç«¯å£ï¼ˆclientPortï¼‰å’Œé›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨ã€‚</p>
<p>é›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br>vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br>vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br><br>server.1=192.168.149.135:2881:3881<br>server.2=192.168.149.135:2882:3882<br>server.3=192.168.149.135:2883:3883<br></code></pre></td></tr></table></figure>

<p>è§£é‡Šï¼šserver.æœåŠ¡å™¨ID&#x3D;æœåŠ¡å™¨IPåœ°å€ï¼šæœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£ï¼šæœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£</p>
<h3 id="5-5-å¯åŠ¨é›†ç¾¤"><a href="#5-5-å¯åŠ¨é›†ç¾¤" class="headerlink" title="5.5)å¯åŠ¨é›†ç¾¤"></a><strong>5.5)å¯åŠ¨é›†ç¾¤</strong></h3><p>å¯åŠ¨é›†ç¾¤å°±æ˜¯åˆ†åˆ«å¯åŠ¨æ¯ä¸ªå®ä¾‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start<br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start<br>/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start<br></code></pre></td></tr></table></figure>



<p><img src="/Hexo/../img/202203121513508.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151332448"> </p>
<p>å¯åŠ¨åæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹æ¯ä¸ªå®ä¾‹çš„è¿è¡ŒçŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br>/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>



<p>å…ˆæŸ¥è¯¢ç¬¬ä¸€ä¸ªæœåŠ¡</p>
<p><img src="/Hexo/../img/202203121513326.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151343292"> </p>
<p>Modeä¸ºfollowerè¡¨ç¤ºæ˜¯<strong>è·Ÿéšè€…</strong>ï¼ˆä»ï¼‰</p>
<p>å†æŸ¥è¯¢ç¬¬äºŒä¸ªæœåŠ¡Mod ä¸ºleaderè¡¨ç¤ºæ˜¯<strong>é¢†å¯¼è€…</strong>ï¼ˆä¸»ï¼‰</p>
<p><img src="/Hexo/../img/202203121513560.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151351510"> </p>
<p>æŸ¥è¯¢ç¬¬ä¸‰ä¸ªä¸ºè·Ÿéšè€…ï¼ˆä»ï¼‰</p>
<p><img src="/Hexo/../img/202203121514253.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151401203"> </p>
<h3 id="5-6-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸"><a href="#5-6-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸" class="headerlink" title="5.6)æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸"></a><strong>5.6)æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸</strong></h3><p>ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬å…ˆæµ‹è¯•å¦‚æœæ˜¯ä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œä¼šæ€ä¹ˆæ ·</p>
<p>æŠŠ3å·æœåŠ¡å™¨åœæ‰ï¼Œè§‚å¯Ÿ1å·å’Œ2å·ï¼Œå‘ç°çŠ¶æ€å¹¶æ²¡æœ‰å˜åŒ–</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh stop<br><br>/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>

<p><img src="/Hexo/../img/202203121514251.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151408189"> </p>
<p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œé›†ç¾¤æ­£å¸¸</p>
<p>ï¼ˆ2ï¼‰æˆ‘ä»¬å†æŠŠ1å·æœåŠ¡å™¨ï¼ˆä»æœåŠ¡å™¨ï¼‰ä¹Ÿåœæ‰ï¼ŒæŸ¥çœ‹2å·ï¼ˆä¸»æœåŠ¡å™¨ï¼‰çš„çŠ¶æ€ï¼Œå‘ç°å·²ç»åœæ­¢è¿è¡Œäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh stop<br><br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>



<p><img src="/Hexo/../img/202203121514305.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151421244"> </p>
<p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œ2ä¸ªä»æœåŠ¡å™¨éƒ½æŒ‚æ‰ï¼Œä¸»æœåŠ¡å™¨ä¹Ÿæ— æ³•è¿è¡Œã€‚å› ä¸ºå¯è¿è¡Œçš„æœºå™¨æ²¡æœ‰è¶…è¿‡é›†ç¾¤æ€»æ•°é‡çš„åŠæ•°ã€‚</p>
<p>ï¼ˆ3ï¼‰æˆ‘ä»¬å†æ¬¡æŠŠ1å·æœåŠ¡å™¨å¯åŠ¨èµ·æ¥ï¼Œå‘ç°2å·æœåŠ¡å™¨åˆå¼€å§‹æ­£å¸¸å·¥ä½œäº†ã€‚è€Œä¸”ä¾ç„¶æ˜¯é¢†å¯¼è€…ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start<br><br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>

<p><img src="/Hexo/../img/202203121514501.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151438444"> </p>
<p>ï¼ˆ4ï¼‰æˆ‘ä»¬æŠŠ3å·æœåŠ¡å™¨ä¹Ÿå¯åŠ¨èµ·æ¥ï¼ŒæŠŠ2å·æœåŠ¡å™¨åœæ‰,åœæ‰åè§‚å¯Ÿ1å·å’Œ3å·çš„çŠ¶æ€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start<br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh stop<br><br>/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>



<p><img src="/Hexo/../img/202203121514156.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151452088"> </p>
<p>å‘ç°æ–°çš„leaderäº§ç”Ÿäº†~  </p>
<p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé€‰ä¸¾çŠ¶æ€ï¼Œç„¶åäº§ç”Ÿæ–°å¾—leader </p>
<p>ï¼ˆ5ï¼‰æˆ‘ä»¬å†æ¬¡æµ‹è¯•ï¼Œå½“æˆ‘ä»¬æŠŠ2å·æœåŠ¡å™¨é‡æ–°å¯åŠ¨èµ·æ¥å¯åŠ¨åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ2å·æœåŠ¡å™¨ä¼šå†æ¬¡æˆä¸ºæ–°çš„é¢†å¯¼å—ï¼Ÿæˆ‘ä»¬çœ‹ç»“æœ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start<br><br>/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br>/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure>



<p><img src="/Hexo/../img/202203121515528.png" srcset="/Hexo/img/loading.gif" lazyload alt="image-20220312151501479"> </p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œ2å·æœåŠ¡å™¨å¯åŠ¨åä¾ç„¶æ˜¯è·Ÿéšè€…ï¼ˆä»æœåŠ¡å™¨ï¼‰ï¼Œ3å·æœåŠ¡å™¨ä¾ç„¶æ˜¯é¢†å¯¼è€…ï¼ˆä¸»æœåŠ¡å™¨ï¼‰ï¼Œæ²¡æœ‰æ’¼åŠ¨3å·æœåŠ¡å™¨çš„é¢†å¯¼åœ°ä½ã€‚</p>
<p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é¢†å¯¼è€…äº§ç”Ÿåï¼Œå†æ¬¡æœ‰æ–°æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ï¼Œä¸ä¼šå½±å“åˆ°ç°ä»»é¢†å¯¼è€…ã€‚</p>
<h2 id="6-Zookeeper-æ ¸å¿ƒç†è®º"><a href="#6-Zookeeper-æ ¸å¿ƒç†è®º" class="headerlink" title="6)Zookeeper æ ¸å¿ƒç†è®º"></a>6)Zookeeper æ ¸å¿ƒç†è®º</h2><p><strong>Zookeepeé›†ç¾¤è§’è‰²</strong></p>
<p>åœ¨ZooKeeperé›†ç¾¤æœä¸­åŠ¡ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼š</p>
<p>â€¢Leader é¢†å¯¼è€… ï¼š          </p>
<pre><code class="hljs">1. å¤„ç†äº‹åŠ¡è¯·æ±‚

2. é›†ç¾¤å†…éƒ¨å„æœåŠ¡å™¨çš„è°ƒåº¦è€…
</code></pre>
<p>â€¢Follower è·Ÿéšè€… ï¼š</p>
<pre><code class="hljs">1. å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™LeaderæœåŠ¡å™¨

2. å‚ä¸Leaderé€‰ä¸¾æŠ•ç¥¨
</code></pre>
<p>â€¢Observer è§‚å¯Ÿè€…ï¼š</p>
<pre><code class="hljs">1. å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™LeaderæœåŠ¡å™¨
</code></pre>
<p><img src="/Hexo/../img/202203121515396.png" srcset="/Hexo/img/loading.gif" lazyload alt="1592058451822"></p>


  

</article>



              </div>
            </div>
          </div>
        </div>
      </div>
    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      

    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
    <!-- å¤‡æ¡ˆä¿¡æ¯ ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      ç²¤ICPè¯123456å·
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/Hexo/img/police_beian.png" srcset="/Hexo/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>ç²¤å…¬ç½‘å®‰å¤‡12345678å·</span>
        </a>
      </span>
    
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/Hexo/js/events.js" ></script>
<script  src="/Hexo/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  




  
    <script  src="/Hexo/js/img-lazyload.js" ></script>
  




  <script  src="/Hexo/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/Hexo/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
